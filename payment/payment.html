<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Form</title>
    <link rel="stylesheet" href="payment.css">
</head>
<body>

    <div class="form-container">
        <h2>Register Here</h2>
        <form id="registrationForm">
            <input type="text" name="name" placeholder="Name" required><br>
            <input type="email" name="email" placeholder="Email" required><br>
            <input type="tel" name="phone" placeholder="Phone" required><br>
            <input type="text" name="address" placeholder="Address" required><br>
            <input type="file" name="image" id="imageInput" accept="image/*" required><br>
            <button type="submit">Submit</button>
        </form>
    </div>

    <script>
        document.getElementById("registrationForm").addEventListener("submit", async function(event) {
            event.preventDefault();

            let formData = new FormData(this);
            let imageFile = formData.get("image");

            try {
                // Upload Image to ImgBB and get URL
                let imageUrl = await uploadImageToImgBB(imageFile);

                if (!imageUrl) {
                    alert("Image upload failed! Please try again.");
                    return;
                }

                // Prepare JSON Data
                let jsonData = {
                    name: formData.get("name"),
                    email: formData.get("email"),
                    phone: formData.get("phone"),
                    address: formData.get("address"),
                    imageUrl: imageUrl // Image URL from ImgBB
                };

                // Submit Data to Google Apps Script
                let response = await fetch("https://script.google.com/macros/s/AKfycbxtj_RjtrCUVIrIuIDYnWECSpNS0KItbnEPeiWtHBcO7wYtN6oVePc6SInuTzmdj4iY/exec", {
                    method: "POST",
                    body: JSON.stringify(jsonData),
                    headers: { "Content-Type": "application/json" }
                });

                let result = await response.text();
                alert("Form Submitted Successfully!");

                // Reset form only after successful submission
                document.getElementById("registrationForm").reset();
            } catch (error) {
                alert("Error submitting form.");
                console.error("Error:", error);
            }
        });

        async function uploadImageToImgBB(file) {
            let apiKey = "ecaa228b4f17c5bdd0ead8588770c689"; // Your ImgBB API Key
            let formData = new FormData();
            formData.append("image", file);

            try {
                let response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: "POST",
                    body: formData
                });

                let data = await response.json();

                if (data.success) {
                    return data.data.url; // Return direct image URL
                } else {
                    console.error("ImgBB Upload Failed:", data);
                    return null;
                }
            } catch (error) {
                console.error("Error uploading image:", error);
                return null;
            }
        }
    </script>

</body>
</html>
