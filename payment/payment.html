// Initialize Firebase
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const storage = firebase.storage(); // For image upload

document.getElementById("paymentForm").addEventListener("submit", function (e) {
  e.preventDefault();

  // Collect form values
  const name = document.getElementById("name").value;
  const year = document.getElementById("year").value;
  const branch = document.getElementById("branch").value;
  const eventType = document.getElementById("eventType").value;
  const subCategory = document.getElementById("subCategory").value;
  const selectedEvents = Array.from(document.getElementById("events").selectedOptions).map(opt => opt.value);
  const transactionId = document.getElementById("transactionId").value;
  const fileInput = document.getElementById("uploadImage").files[0]; // Get uploaded image

  if (!selectedEvents.length) {
    alert("Please select at least one event.");
    return;
  }

  // Push data to Firebase Database
  const newEntryRef = database.ref("registrations").push();
  newEntryRef.set({
    name,
    year,
    branch,
    eventType,
    subCategory,
    selectedEvents,
    transactionId,
    imageURL: "" // Placeholder for uploaded image URL
  }).then(() => {
    if (fileInput) {
      const storageRef = storage.ref(`payment_images/${newEntryRef.key}_${fileInput.name}`);
      return storageRef.put(fileInput).then(snapshot => {
        return snapshot.ref.getDownloadURL();
      }).then(downloadURL => {
        newEntryRef.update({ imageURL: downloadURL });
      });
    }
  }).then(() => {
    alert("Registration submitted successfully!");
    document.getElementById("paymentForm").reset(); // Clear form
  }).catch(error => {
    console.error("Error submitting registration:", error);
    alert("Error submitting registration. Please try again.");
  });
});
